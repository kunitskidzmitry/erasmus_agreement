<odoo>
	<data>
		<template id="portal_my_agreements" name="My Learning Agreements">
			<t t-call="portal.portal_layout">
				<t t-set="breadcrumbs">
					<li class="breadcrumb-item"><a href="/my">My Account</a></li>
					<li class="breadcrumb-item active">Learning Agreements</li>
				</t>
				<div class="o_portal_wrap">
					<h2>My Learning Agreements</h2>
					<table class="table table-striped">
						<thead>
							<tr>
								<th>Reference</th>
								<th>Coordinator</th>
								<th>Status</th>
								<th>Signature</th>
								<th></th>
							</tr>
						</thead>
						<tbody>
							<t t-foreach="agreements" t-as="ag">
								<tr>
									<td><t t-esc="ag.name"/></td>
									<td><t t-esc="ag.coordinator_partner_id.name or ''"/></td>
									<td><t t-esc="ag.state"/></td>
									<td><t t-esc="ag.signature_status"/></td>
									<td>
										<a class="btn btn-sm btn-primary" t-att-href="'/my/learning-agreement/%s' % ag.id">Open</a>
									</td>
								</tr>
							</t>
						</tbody>
					</table>
				</div>
			</t>
		</template>

		<template id="portal_learning_agreement_form" name="Learning Agreement Form">
			<t t-call="portal.portal_layout">
				<t t-set="breadcrumbs">
					<li class="breadcrumb-item"><a href="/my">My Account</a></li>
					<li class="breadcrumb-item"><a href="/my/learning-agreements">Learning Agreements</a></li>
					<li class="breadcrumb-item active"><t t-esc="agreement.name"/></li>
				</t>
				<div class="o_portal_wrap">
					<h2><t t-esc="agreement.name"/></h2>
					<p>Fill in your contact details. These fields will be used in the Learning Agreement.</p>
					<form t-att-action="'/my/learning-agreement/%s' % agreement.id" method="post">
						<input type="hidden" name="access_token" t-att-value="access_token"/>
						<div class="row">
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Full Name</label>
									<input type="text" name="student_full_name" class="form-control" t-att-value="agreement.student_full_name or ''"/>
								</div>
								<div class="mb-3">
									<label class="form-label">Email</label>
									<input type="email" name="student_email" class="form-control" t-att-value="agreement.student_email or ''"/>
								</div>
								<div class="mb-3">
									<label class="form-label">Phone</label>
									<input type="text" name="student_phone" class="form-control" t-att-value="agreement.student_phone or ''"/>
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Street</label>
									<input type="text" name="student_street" class="form-control" t-att-value="agreement.student_street or ''"/>
								</div>
								<div class="mb-3">
									<label class="form-label">Street 2</label>
									<input type="text" name="student_street2" class="form-control" t-att-value="agreement.student_street2 or ''"/>
								</div>
								<div class="mb-3">
									<label class="form-label">ZIP</label>
									<input type="text" name="student_zip" class="form-control" t-att-value="agreement.student_zip or ''"/>
								</div>
								<div class="mb-3">
									<label class="form-label">City</label>
									<input type="text" name="student_city" class="form-control" t-att-value="agreement.student_city or ''"/>
								</div>
								<div class="mb-3">
									<label class="form-label">Country</label>
									<select name="student_country_id" class="form-select">
										<option value="">Select...</option>
										<t t-foreach="request.env['res.country'].sudo().search([])" t-as="c">
											<option t-att-value="c.id" t-att-selected="'selected' if agreement.student_country_id.id == c.id else None"><t t-esc="c.name"/></option>
										</t>
									</select>
								</div>
							</div>
						</div>
						<button type="submit" class="btn btn-primary">Save</button>
					</form>

					<t t-if="agreement.message_ids">
						<hr/>
						<h4>Messages</h4>
						<div class="list-group">
							<t t-foreach="agreement.message_ids.sorted('date', reverse=True)" t-as="msg">
								<div class="list-group-item">
									<div class="small text-muted"><t t-esc="(msg.author_id.name or 'System') + ' - ' + (msg.date and msg.date.strftime('%Y-%m-%d %H:%M') or '')"/></div>
									<div t-raw="msg.body"/>
								</div>
							</t>
						</div>
						<form t-att-action="'/my/learning-agreement/%s/message' % agreement.id" method="post" class="mt-3">
							<input type="hidden" name="access_token" t-att-value="access_token"/>
							<div class="mb-3">
								<label class="form-label">New message</label>
								<textarea name="message" class="form-control" rows="3"></textarea>
							</div>
							<button type="submit" class="btn btn-secondary">Send</button>
						</form>
					</t>
				</div>
			</t>
		</template>
	</data>
</odoo>